{% extends 'Conex/a.html' %} {% block content %}
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  {% load static %}

  <link rel="stylesheet" href="{% static 'musicalapp/carrito.css' %}" />
  <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
  />
  <link href="{% static 'fontawesome/css/all.min.css' %}" rel="stylesheet" />
  <script src="{% static 'js/carrito.js' %}"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=AWYFiO3-dMYwQD01FcCWn4an7L2c6PWNh2bGZ8rFj8gNxjRViEpl8tx4DTOQ7Ugb4dnUql7d24PtjaKe&currency=MXN"></script>
</head>

<body>
  <div class="center">
    <div class="container mt- mb-4">
      <div
        class="d-flex justify-content-center row"
        style="padding-left: 150px"
      >
        <div class="col-md-8" style="padding-top: 100px; text-align: center">
          <h1 class="title">Carrito de compra</h1>
          <div class="aw">
            <div class="col-12">
              {% if instrumentos_en_carrito %}
              <table
                class="table table-responsive table-striped"
                style="
                  order-radius: 35px;
                  box-shadow: 20px 20px 34px rgba(0, 0, 0, 0.15);
                "
              >
                <thead>
                  <tr class="header">
                    <th scope="col">Productos</th>
                    <th scope="col"></th>
                    <th scope="col">Precio</th>
                    <th scope="col">Cantidad</th>
                    <th scope="col" class="text-center">SubTotal</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody
                  class="d-flex flex-column align-items-center product-details"
                >
                  {% for lista in instrumentos_en_carrito %}
                  <tr>
                    <td class="item font-weight-bold">
                      {{ lista.intrumento.nombre }}
                    </td>
                    <td class="item font-weight-bold">
                      <img
                        id="producto"
                        style="
                          max-width: 150px;
                          max-height: 150px;
                          order-radius: 35px;
                          box-shadow: 20px 20px 34px rgba(0, 0, 0, 0.15);
                        "
                        src="{{ lista.intrumento.imagen }} "
                        alt="{{ lista.intrumento.nombre }}"
                      />
                    </td>
                    <td class="price text-center">
                      ${{ lista.intrumento.precio }}
                    </td>
                    <td class="quantity">
                      {{ lista.cantidad }}
                      <span class="focus-border"></span>
                    </td>
                    <td>${{ lista.subtotal }}</td>
                    <td>
                      <form
                        method="POST"
                        action="{% url 'musicalapp:quitar_del_carrito' lista.id %}"
                      >
                        {% csrf_token %}
                        <button class="btn btn-sm remove" type="submit">
                          Quitar
                          <i class="fa fa-trash mb-1 p-4 text-danger"></i>
                        </button>
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div class="col-md-12">
              <h3 class="m-5">
                Total: $<a style="text-decoration: none">{{ montofinal }}</a>
              </h3>

              <h3 class="m-5">
                <a
                  href="{% url 'musicalapp:lista_instrumentos'%}"
                  style="text-decoration: none"
                  >Seguir comprando</a
                >
              </h3>
              <h3 class="m-5">
                <div id="paypal-button-container"></div>
                <script montofinal="{{montofinal}}">
                  paypal
                    .Buttons({
                      createOrder: function (data, actions) {
                        return actions.order.create({
                          purchase_units: [
                            {
                              amount: {
                                value: "{{ montofinal }}",
                              },
                            },
                          ],
                        });
                      },
                      onApprove: function (data, actions) {
                        return fetch("/ruta/hacia/completar_pago/", {
                          method: "post",
                        }).then(function () {
                          // Redirigir al usuario después de completar el pago
                          window.location.href =
                            "{% url 'musicalapp:completar_pago' %}";
                        });
                      },
                      style: {
                        layout: "horizontal",
                      },
                    })
                    .render("#paypal-button-container");
                </script>
              </h3>

              {% else %}
              <!-- Mostrar un mensaje si el carrito está vacío -->
              <h2 style="padding-right: 100px">Carrito vacio.</h2>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

{% endblock %}
